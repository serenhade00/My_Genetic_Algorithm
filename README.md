# 🧬유전 알고리즘 적용 회귀분석🧬

## 개요
***
<br>

* `Genetic Algorithm` 의 정의와 목적
* 회귀 분석 및 선정 데이터 설명
* `Genetic Algorithm` 실제 구현 프로그램 분석
    * 코드 동작 방식
    * 코드 실행 결과
    * 코드 성능 분석
* 프로그램의 한계 및 개선점
* 결론

## 유전 알고리즘에 관하여
***

**유전 알고리즘(Genetic Algorithm)** 은 도대체 무엇이며, 언제 사용되는 알고리즘인가?

**정의:**

- 존 홀랜드(John Holland)에 의해서 1975년에 개발된 **전역 최적화 기법**. 
- <mark>생물체가 환경에 적응하면서 진화해가는 모습을 모방</mark>하여 **유전** 알고리즘이라고 불린다.

전역 최적화 vs 지역 최적화

<img src = "https://github.com/serenhade00/My_Genetic_Algorithm/blob/main/img/global.jpg?raw=true" width="500" height ="300">

* **전역 최적화**는 다소 시간이 걸리더라도 전체 탐색영역에서 가장 좋은 해를 찾는 것을 목표로 하는 방법이다.

* **지역 최적화**는 비교적 단시간에 일부 탐색영역 내에서 가장 좋은 해를 찾는 것을 목표로 하는 방법이다. 

> 유전 알고리즘은 **전역 최적화** 기법이다.

**관련 용어:**

| 값 | 의미 |
|--- |---|
| `염색체 (chromosome)` | 하나의 해 (solution)를 표현 | 
| `유전자 (gene)` | 염색체 구성 요소, 하나의 유전 정보를 나타낸다.|  
| `자손 (offspring)` | 부모 염색체로부터 생성된 다음 세대 염색체 |  
| `적합도 (fitness)` | 염색체가 표현하는 해가 얼마나 적합한지 나타내는 값 |

**동작 방식:**

<img src = "https://github.com/serenhade00/My_Genetic_Algorithm/blob/main/img/genetic.png?raw=true" width="500" height ="300">

진행 방식은 다음과 같다.

1) 초기 염색체 집합 생성
2) 초기 염색체들에 대한 적합도 계산
3) 현재 염색체들로부터 자손들을 생성
4) 생성된 자손들의 적합도 계산
5) 종료 조건 판별
- 종료 조건이 거짓인 경우, (3)으로 이동하여 반복
- 종료 조건이 참인 경우, 알고리즘을 종료

즉, **적합도를 계산하고, 자손들을 만드는 과정의 반복**이다. 적합도가 높은 개체로만 해를 구성해 나가면서, 결국 많은 세대가 반복된다면 최적해에 가까운 해를 얻어낼 수 있는것이다. 

따라서 대부분의 경우는 세대가 일정 수준 진행되거나, 해가 특정 범위에 들게되면 알고리즘을 종료한다.

알고리즘의 핵심 연산은 다음과 같다.

* 선택(selection)
    - 한 세대에서 다음 세대로 전해지는 해의 후보들을 선정한다.
    - 즉, 자손 염색체를 만들때, 어떤 부모 염색체를 가지고 만들지를 정하는 것
* 교차(crossover)
    - 선택된 해들을 교배시켜 새로운 유전자(해)를 얻는 과정
* 변이(mutation)
    - 유전자가 스스로 변이를 일이켜 임의로 다른 해로 변하는 일

각 연산마다 여러 방법이 있지만 가장 대표적인 방법들을 사용했다.

선택 연산:

<img src = "https://github.com/serenhade00/My_Genetic_Algorithm/blob/main/img/roulette.png?raw=true" width="500" height ="300">

<p align="center">룰렛 휠 (Roulette Wheel)</p>

위의 그림을 보자. 

선택 연산전에는 각 해에 대한 적합도가 이미 계산된 상태이다. 그 적합도를 모두 합한뒤 각 해가 가지는 적합도를 비율을 룰렛 형태로 나타낸다. 그 후 다음 세대의 개수만큼 룰렛에서 해를 뽑아낸다. 즉, **적합도가 높을수록 선택될 확률이 높은 선택 연산**으로, *룰렛 휠 (Roulette Wheel)* 방법이라고 한다. 아무래도 좋은 해가 부모로 선택되어 자손이 나오면 좋을테니 그 의도를 가진 선택 연산이다.

교차 연산:

![sixth](https://github.com/serenhade00/My_Genetic_Algorithm/blob/main/img/crossover.png?raw=true)

선택 연산으로 정해진 해를 2진수로 나타내고, 짝지어진 해끼리의 비트(bit)의 특정 부분을 교차하는 것이다. 이렇게 교차 연산 후에 나온 해들이 새로운 세대의 해가 되는것이다.

변이 연산:

<img src = "https://github.com/serenhade00/My_Genetic_Algorithm/blob/main/img/mutate.png?raw=true" width="500" height ="300">

지역 최적점에 빠지는 문제를 해결하기 위해 새롭게 생성된 염색체에 확률적으로 돌연변이가 발생하도록 한다. 일반적으로 0.1%, 0.05% 등의 아주 낮은 확률로 돌연변이가 발생하도록 설정한다. 

대표적으로 1) reverse 와 2) exchange 연산이 있는데(그림 오류), 여기서는 비트를 반전시키는 1. reverse 방법을 채택했다.

## 회귀 분석 및 선정 데이터 분석
***

우리는 이제 유전 알고리즘에 대해 알게되었다. 그렇다면 이제 이 최적화 기법을 이용해 과연 어떤 문제를 풀어볼지 알아보자. 그것이 바로, **회귀 분석**이다.

**회귀 분석이란?**

<img src = "https://github.com/serenhade00/My_Genetic_Algorithm/blob/main/img/linear_regression.png?raw=true" width="500" height ="300">

우리는 데이터가 주어지면 어떤 형태의 패턴을 나타낼 것이라고 가정한다. 예를 들면 위 그림에서의 데이터들은 x가 증가하면 y도 증가하는 선형적인 모습을 보인다. 이런 경향을 식으로 나타내면 *y = ax+b*의 형태가 나타날 것이다.

이 때 정의한 식 *y = ax+b*를 **모형(model)** 이라고 하고, 모형의 형태를 결정짓는 변수 *a, b*를 **파라미터(parameter)** 또는 **모수(母數)** 라고한다.

즉, 회귀 분석을 한마디로 정의하면 이렇다.
> 독립변수가 종속변수에 어떤 영향을 미치는지 알기 위해 실시하는 분석방법

물론 자연에서도 그렇고 인간 사회에서도 그렇고 존재하는 데이터들이 항상 선형적인 모습만을 보이지는 않을것이다. 하지만 이번 프로젝트에서는 비교적 분석하기 쉽게 선형적인 회귀 분석만 진행한다. 

**식 적절성 판단 방법:**

식을 찾았을 때, 그 모형이 데이터에 얼마나 잘 맞는지를 측정할 방법이 필요하다. 이 때 사용하는 함수가 **손실 함수(loss function)** 라고 부르며, 모형이 데이터에 얼마나 안 맞는지 정도를 나타낸다.

<p align="center"><img src = "https://github.com/serenhade00/My_Genetic_Algorithm/blob/main/img/mse.jpg?raw=true"></p>

1. 가장 널리 쓰이는 손실 함수는 **평균 제곱 오차(*Mean Squared Error*, MSE)** 이다. 예측과 실제의 차이를 오차(error)라고 한다. 이 오차를 모두 제곱한 다음에 평균 낸 것이 MSE이다.

- 여기서 한 가지 의문이 든다. 왜 하필 제곱을 하는 것일까? 예측을 두 번 했는데 오차가 +1, -1인 경우와, 오차가 +5, -5인 경우를 생각해보자. 제곱을 하지 않고 오차의 평균을 구하면 두 경우 모두 오차의 평균은 0이 된다. 1-1도 0이고, 5-5도 0이기 때문이다. 따라서 오차 정도를 고려하기 위해 제곱을 한다. 

<p align="center"><img src = "https://github.com/serenhade00/My_Genetic_Algorithm/blob/main/img/R.jpg?raw=true"></p>

2. MSE의 단점은 크고, 작음을 직관적으로 알기 어렵다는데 있다. 예를 들어 MSE가 20이라면, 또는 100이라면 이 모형은 얼마나 적절한지 잘 와닿지 않는다. 이를 보완하는 수치가 **결정 계수(coefficient of determination)** 이다. 

- VAR은 분산을 뜻한다. (데이터와 평균의 차이를 제곱해서 평균낸 것)
- R^2은 대개 0에서 1까지 범위로 나오기 때문에 0%~100%로 읽기도 한다. 
- 보통 "이 모형은 분산의 ~%를 설명한다"라는 식으로 해석한다. 예를 들어 
R^2 = 0.7이라면 "이 모형은 분산의 70%를 설명한다"라고 해석한다.
- 분산은 데이터에 고정된 값이기 때문에 R^2은 실제로는 MSE를 정확히 반영하는 값이다. 즉, MSE가 커지면 작아지고, MSE가 작아지면 커진다. 

> 즉 유전 알고리즘에서 선택 과정 이후에 적합도를 구하는 단계가 있는데, 여기서 이 손실 함수 중 MSE를 사용해서 해의 적합도를 판단하고 교차 단계로 들어갈 것이다.

### 선정 데이터

상관관계가 있는 대용량의 데이터를 찾아보려고 노력했으나 찾기가 쉽지 않았다. 그래서 용량은 작지만 그래도 확실한 상관관계를 보이는 데이터를 기반으로 분석을 진행한다. 사실 이 부분은 좀 아쉬운 부분이긴하다.

선정한 데이터는 바로 **"고도에 따른 산에서의 온도"** 이다. 

<br>
<p align="center"><img src = "https://github.com/serenhade00/My_Genetic_Algorithm/blob/main/img/graph1.jpg?raw=true"></p>

데이터가 20개 이하 정도의 소규모 데이터라 너무 패턴이 극단적으로 선형적이긴 하지만, 그래도 선형 회귀 모델로 쓰기에는 문제가 없기 때문에 채택하였다. 

과학적인 사실로는 지표면으로부터 멀어질수록 태양 복사열이 낮아져 온도가 감소한다는 사실이 밝혀져있다. 따라서 고도가 높아질수록, 기온이 낮아지는 상관관계를 가지고 있는 이 데이터를 가지고, 분석을 해보도록 하겠다.

## 유전 알고리즘 실제 구현 프로그램 분석
***

### 코드 동작 방식


## 결론
***

- 유전 알고리즘은 이론적으로 전역 최적점을 찾을 수 있으며, 수학적으로 명확하게 정의되지 않은 문제에도 적용할 수 있기 때문에 매우 유용하게 이용된다. 일반적으로 유전 알고리즘에 대해 알고리즘이라는 표현을 이용하지만, 유전 알고리즘은 특정한 문제를 풀기 위한 알고리즘이라기 보다는 최적화 문제를 풀기 위한 방법론에 가깝다. 즉, 모든 문제에 적용 가능한 하나의 알고리즘이나 소스 코드가 있는 것이 아니기 때문에 유전 알고리즘의 원리를 이해하고, 이를 자신이 원하는 문제에 적용할 수 있도록 하는 것이 중요하다.
